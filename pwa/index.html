<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Proyectos PWA</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="/img/logoproyectos.png" type="image/png">
    <link rel="stylesheet" href="/css/tailwind.output.css">
    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            alert('Error: ' + msg + '\nLine: ' + lineNo + '\nURL: ' + url);
            return false;
        };
        window.addEventListener('unhandledrejection', function (event) {
            alert('Unhandled Rejection: ' + event.reason);
        });
    </script>
    <style>
        @keyframes pulsate {
            0% {
                transform: scale(1);
                opacity: 0.1;
            }

            50% {
                transform: scale(5);
                opacity: 0.8;
            }

            100% {
                transform: scale(0.7);
                opacity: 1;
            }
        }

        .animate-pulsate {
            animation: pulsate 1.5s infinite ease-in-out;
        }

        /* Hide scrollbar for clean mobile look */
        ::-webkit-scrollbar {
            display: none;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            margin-top: 4px;
            border-radius: 12px;
        }

        .typing-indicator span {
            width: 6px;
            height: 6px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes typing {

            0%,
            80%,
            100% {
                transform: scale(0);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 font-sans h-screen w-screen overflow-hidden">

    <!-- Splash Screen -->
    <div id="splash-screen"
        class="fixed inset-0 z-50 flex items-center justify-center bg-white transition-opacity duration-1000">
        <img src="/img/logoproyectos.png" alt="Logo" class="w-32 h-32 animate-pulsate">
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="hidden fixed inset-0 z-40 flex items-center justify-center bg-gray-50 p-6">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm">
            <div class="flex justify-center mb-6">
                <img src="/img/logo_bipoint.png" alt="Logo" class="w-20 h-20">
            </div>
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Iniciar Sesi√≥n</h2>
            <form id="login-form" autocomplete="off">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">CUIT</label>
                    <input type="number" id="cuit"
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        placeholder="Ej: 20123456789" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Usuario</label>
                    <input type="text" id="usuario"
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        placeholder="Usuario" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Contrase√±a</label>
                    <div class="relative">
                        <input type="password" id="password"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline pr-10"
                            required>
                        <button type="button" id="toggle-password"
                            class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-600 hover:text-gray-800 focus:outline-none">
                            <!-- Eye Icon -->
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                    </div>
                </div>
                <button type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                    Entrar
                </button>
            </form>
            <p id="login-error" class="text-red-500 text-sm text-center mt-4 hidden"></p>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="app-screen" class="hidden fixed inset-0 z-30 flex flex-col bg-gray-50">
        <!-- Header -->
        <header class="bg-blue-600 text-white p-4 flex justify-between items-center shadow-md">
            <div class="flex items-center">
                <button id="menu-btn" class="focus:outline-none mr-4">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <h1 class="text-xl font-bold">Mis Proyectos Layout</h1>
            </div>
            <img id="header-profile-img" src='usuario.png' alt="Perfil"
                class="w-8 h-8 bg-white rounded-full p-1 object-cover">
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow p-4 overflow-y-auto">

            <!-- Home View -->
            <div id="view-home">
                <h2 class="text-2xl font-bold mb-4">Bienvenido</h2>
                <p class="mb-4">Seleccione una opci√≥n del men√∫ para comenzar.</p>
                <div class="bg-white p-4 rounded shadow">
                    <p>Contenido de ejemplo...</p>
                </div>
            </div>

            <!-- Messages View -->
            <div id="view-messages" class="hidden">
                <h2 class="text-2xl font-bold mb-4">Mensajes</h2>

                <!-- Tabs -->
                <div class="flex border-b border-gray-200 mb-4">
                    <button id="tab-btn-unread" onclick="switchTab('unread')"
                        class="flex-1 py-2 px-4 text-center font-bold text-blue-600 border-b-2 border-blue-600 focus:outline-none">
                        No Le√≠dos (<span id="count-unread-tab">0</span>)
                    </button>
                    <button id="tab-btn-read" onclick="switchTab('read')"
                        class="flex-1 py-2 px-4 text-center font-bold text-gray-500 hover:text-gray-700 focus:outline-none">
                        Le√≠dos (<span id="count-read-tab">0</span>)
                    </button>
                </div>

                <!-- Unread Content -->
                <div id="content-unread" class="space-y-4">
                    <p class="text-center text-gray-500">Cargando mensajes...</p>
                </div>

                <!-- Read Content -->
                <div id="content-read" class="space-y-4 hidden">
                    <!-- Populated via JS -->
                </div>
            </div>

            <!-- Send Message View -->
            <div id="view-send-message" class="hidden flex flex-col h-full overflow-hidden">
                <h2 class="text-2xl font-bold mb-4 flex-shrink-0">Enviar Mensaje</h2>
                <!-- Tabs -->
                <div class="flex border-b border-gray-200 mb-2 shrink-0">
                    <button id="tab-send-users" onclick="switchSendTab('users')"
                        class="flex-1 py-2 px-4 text-center font-bold text-blue-600 border-b-2 border-blue-600 transition-colors">Destinatarios</button>
                    <button id="tab-send-details" onclick="switchSendTab('details')"
                        class="flex-1 py-2 text-center font-bold text-gray-500 hover:text-gray-700 transition-colors">Detalles</button>
                </div>

                <!-- Content Users -->
                <div id="send-content-users" class="flex-1 flex flex-col overflow-hidden min-h-0">
                    <!-- Filter -->
                    <div class="p-2 border-b shrink-0 flex gap-2">
                        <input type="text" id="send-user-search" placeholder="Buscar destinatario..."
                            class="flex-1 border rounded px-2 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                        <button class="bg-blue-100 text-blue-700 font-bold px-3 rounded text-xs"
                            onclick="toggleSelectAllSend()">Todos</button>
                    </div>
                    <!-- List -->
                    <div id="send-user-list" class="flex-1 overflow-y-auto p-2 space-y-2">
                        <div class="text-center text-gray-400 mt-4">Cargando usuarios...</div>
                    </div>
                    <div class="p-3 bg-gray-50 text-xs shrink-0 border-t flex justify-between items-center">
                        <span>Seleccionados: <span id="send-selected-count"
                                class="font-bold text-blue-600">0</span></span>
                        <button onclick="switchSendTab('details')"
                            class="bg-blue-600 text-white px-3 py-1 rounded font-bold">Continuar &rarr;</button>
                    </div>
                </div>

                <!-- Content Details -->
                <div id="send-content-details" class="hidden flex-1 flex flex-col overflow-y-auto min-h-0">
                    <div class="p-4 space-y-4">
                        <!-- Channels -->
                        <div class="bg-white p-3 rounded border">
                            <label class="block text-sm font-bold mb-2 text-gray-700">Canales de Env√≠o</label>
                            <div class="flex gap-4">
                                <label class="flex items-center gap-2 text-sm"><input type="checkbox"
                                        id="send-channel-web" checked class="w-4 h-4 text-blue-600"> Web</label>
                                <label class="flex items-center gap-2 text-sm"><input type="checkbox"
                                        id="send-channel-app" checked class="w-4 h-4 text-green-600"> App</label>
                            </div>
                        </div>
                        <!-- Date Time -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-700">Fecha</label>
                                <input type="date" id="send-date"
                                    class="w-full border rounded p-2 text-sm focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold mb-1 text-gray-700">Hora</label>
                                <input type="time" id="send-time"
                                    class="w-full border rounded p-2 text-sm focus:ring-blue-500">
                            </div>
                        </div>
                        <!-- Title -->
                        <div>
                            <label class="block text-sm font-bold mb-1 text-gray-700">T√≠tulo</label>
                            <input type="text" id="send-title"
                                class="w-full border rounded p-2 text-sm focus:ring-blue-500"
                                placeholder="Asunto del mensaje">
                        </div>
                        <!-- Body -->
                        <div>
                            <label class="block text-sm font-bold mb-1 text-gray-700">Mensaje</label>
                            <textarea id="send-body"
                                class="w-full border rounded p-2 h-32 text-sm focus:ring-blue-500 resize-none"
                                placeholder="Escriba su mensaje..."></textarea>
                        </div>

                        <button onclick="submitSystemMessage()" id="btn-submit-message"
                            class="w-full bg-blue-600 text-white font-bold py-3 rounded shadow hover:bg-blue-700 transition-colors">Enviar
                            Mensaje</button>
                        <button onclick="switchSendTab('users')"
                            class="w-full text-gray-500 font-bold py-2 text-sm mt-1">Volver a Destinatarios</button>
                    </div>
                </div>

                <!-- Team Chat View -->
                <div id="view-team-chat" class="hidden flex flex-col h-full overflow-hidden">
                    <h2 class="text-2xl font-bold mb-4 flex-shrink-0">Chat de Equipo</h2>
                    <div id="chat-container"
                        class="flex-grow bg-white rounded shadow p-4 flex flex-col h-full overflow-hidden">
                        <div class="flex-grow flex items-center justify-center text-gray-500">
                            <p>Seleccione un usuario para chatear (Pr√≥ximamente)</p>
                        </div>
                    </div>
                </div>

                <!-- Config View -->
                <div id="view-config" class="hidden">
                    <h2 class="text-2xl font-bold mb-4">Configuraci√≥n</h2>
                    <div class="bg-white p-6 rounded shadow">
                        <h3 class="font-bold text-lg mb-4">Foto de Perfil</h3>
                        <p class="text-sm text-gray-600 mb-4">Sube una selfie para tu perfil.</p>

                        <div class="flex flex-col items-center gap-4">
                            <div
                                class="w-32 h-32 bg-gray-200 rounded-full overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-400 relative">
                                <img id="photo-preview" class="hidden w-full h-full object-cover">
                                <span id="photo-placeholder" class="text-gray-400 text-4xl">üì∑</span>
                            </div>

                            <!-- Button to take/select photo -->
                            <label
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded cursor-pointer w-full text-center">
                                Tomar Foto / Seleccionar
                                <input type="file" id="photo-input" accept="image/*" capture="user" class="hidden">
                            </label>

                            <!-- Upload Button (Hidden initially) -->
                            <button id="upload-btn"
                                class="hidden bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded w-full disabled:bg-gray-400">
                                Subir Foto
                            </button>
                        </div>
                    </div>
                </div>

        </main>

        <!-- Sidebar / Drawer (Overlay) -->
        <div id="drawer-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity opacity-0">
        </div>

        <!-- Sidebar / Drawer (Menu) -->
        <nav id="drawer"
            class="fixed inset-y-0 left-0 transform -translate-x-full w-64 bg-white text-gray-800 z-50 transition-transform duration-300 ease-in-out shadow-2xl flex flex-col">
            <div class="p-6 bg-blue-600 text-white">
                <h2 class="text-2xl font-bold">Men√∫</h2>
                <p id="user-display" class="text-sm opacity-75 mt-1">Usuario</p>
            </div>
            <ul class="flex-grow py-4">
                <li><a href="#" class="block px-6 py-3 hover:bg-blue-50 border-b border-gray-100"
                        onclick="showView('home')">üìã Mis Tareas</a></li>
                <li><a href="#" class="block px-6 py-3 hover:bg-blue-50 border-b border-gray-100">üìÖ Calendario</a></li>
                <li><a href="#" class="block px-6 py-3 hover:bg-blue-50 border-b border-gray-100"
                        onclick="showView('team-chat')">üí¨ Chat de Equipo</a>
                </li>
                <li><a href="#" class="block px-6 py-3 hover:bg-blue-50 border-b border-gray-100">üìä Reportes</a></li>
                <li>
                    <div class="px-6 py-3 border-b border-gray-100 flex justify-between items-center cursor-pointer hover:bg-blue-50 transition-colors"
                        onclick="toggleSubmenu('submenu-mensajes')">
                        <span>üì® Mensajes</span>
                        <svg class="w-4 h-4 transform transition-transform duration-200" id="arrow-submenu-mensajes"
                            fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <ul id="submenu-mensajes"
                        class="hidden bg-gray-50 border-b border-gray-100 transition-all duration-300">
                        <li><a href="#"
                                class="block pl-12 pr-6 py-3 hover:bg-blue-100 text-sm border-b border-gray-100 border-opacity-50"
                                onclick="showView('messages')">Inbox (Mis Mensajes)</a></li>
                        <li><a href="#" class="block pl-12 pr-6 py-3 hover:bg-blue-100 text-sm"
                                onclick="showView('send-message')">Redactar / Enviar</a></li>
                    </ul>
                </li>
                <li><a href="#" class="block px-6 py-3 hover:bg-blue-50 border-b border-gray-100" id="nav-config"
                        onclick="showView('config')">‚öôÔ∏è Configuraci√≥n</a>
                </li>
                <li><a href="#" class="block px-6 py-3 hover:bg-blue-50 border-b border-gray-100">‚ùì Ayuda</a></li>
                <li id="install-item" class="hidden"><a href="#" id="install-btn"
                        class="block px-6 py-3 hover:bg-green-50 border-b border-gray-100 text-green-700 font-bold">üì≤
                        Instalar Aplicaci√≥n</a></li>
            </ul>
            <div class="p-4 border-t">
                <button id="logout-btn"
                    class="w-full text-left px-4 py-2 text-red-600 font-bold hover:bg-red-50 rounded">
                    üö™ Cerrar Sesi√≥n
                </button>
            </div>
        </nav>
    </div>

    <!-- Toast Notification -->
    <div id="toast-container"
        class="fixed top-4 left-1/2 transform -translate-x-1/2 z-[60] flex flex-col gap-2 w-full max-w-sm px-4 pointer-events-none">
        <!-- Toasts will be injected here -->
    </div>

    <!-- Photo Options Modal (Action Sheet) -->
    <div id="photo-options-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex flex-col justify-end">
        <div class="bg-white rounded-t-xl p-4 slide-up-animation">
            <h3 class="text-center font-bold text-lg mb-4 text-gray-700">Foto de Perfil</h3>
            <div class="flex flex-col gap-3">
                <button id="btn-camera"
                    class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 13a3 3 0 11-6 0 3 3 0 016 0z">
                        </path>
                    </svg>
                    Tomar Selfie
                </button>
                <button id="btn-gallery"
                    class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    Galer√≠a
                </button>
                <button id="btn-delete-photo"
                    class="w-full bg-red-100 text-red-600 font-bold py-3 rounded-lg flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                        </path>
                    </svg>
                    Eliminar Foto
                </button>
                <button id="btn-cancel-photo" class="w-full bg-gray-200 text-gray-800 font-bold py-3 rounded-lg mt-2">
                    Cancelar
                </button>
            </div>
            <!-- Hidden Input moved here or kept global -->
            <input type="file" id="header-photo-input" accept="image/*" class="hidden">
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script></script>
    <!-- App Logic -->
    <script src="app.js?v=13"></script>
</body>

</html>